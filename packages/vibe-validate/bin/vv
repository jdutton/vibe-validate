#!/usr/bin/env node
/**
 * Thin wrapper that delegates to @vibe-validate/cli
 * This ensures single source of truth for all wrapper logic.
 *
 * Supports VV_ROOT_DIR override for developer testing:
 *   VV_ROOT_DIR=~/Workspaces/vibe-validate vv validate
 */
import { existsSync } from 'fs';
import { fileURLToPath, pathToFileURL } from 'url';
import { dirname, join } from 'path';

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

// VV_ROOT_DIR override: use dev build's CLI wrapper instead of published one
// This lets developers test their local build against any project
const vvRootDir = process.env.VV_ROOT_DIR;
let cliWrapperPath;
if (vvRootDir) {
  const devWrapper = join(vvRootDir, 'packages/cli/dist/bin/vibe-validate.js');
  if (existsSync(devWrapper)) {
    console.error(`[vv] Using VV_ROOT_DIR: ${vvRootDir}`);
    cliWrapperPath = devWrapper;
  } else {
    console.error(`[vv] VV_ROOT_DIR set but ${devWrapper} not found â€” ignoring`);
    cliWrapperPath = join(__dirname, '../node_modules/@vibe-validate/cli/dist/bin/vibe-validate.js');
  }
} else {
  cliWrapperPath = join(__dirname, '../node_modules/@vibe-validate/cli/dist/bin/vibe-validate.js');
}

// Import and execute the CLI wrapper
// Use pathToFileURL for Windows compatibility (import() requires file:// URLs)
await import(pathToFileURL(cliWrapperPath).href);
