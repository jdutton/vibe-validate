$schema: ../sample-schema.json

# Vitest snapshot mismatch - common in UI/component testing

metadata:
  tool: vitest
  toolVersion: "3.2.4"
  platform: linux
  nodeVersion: "22.0.0"
  contributor: claude-code
  contributedDate: "2025-10-22"
  sourceIssue: null
  sourcePR: null
  category: assertion-failure
  difficulty: easy
  description: |
    Snapshot mismatch in Vitest when rendered output doesn't match saved snapshot.
    Very common pattern in UI testing, component testing, and serialization tests.
    Includes both expected (snapshot) and received (actual) output.

input:
  raw: |
    ❌ packages/cli/test/formatter.test.ts > OutputFormatter > should format validation state correctly

      Snapshot `validation state output 1` mismatched

        - Expected
        + Received

        - Status: ✅ PASSED
        + Status: ❌ FAILED
          Timestamp: 2025-10-22T10:30:00Z
        - Cached: true
        + Cached: false

          Steps:
        -   typecheck: PASSED (0.5s)
        -   test: PASSED (2.1s)
        +   typecheck: PASSED (0.5s)
        +   test: FAILED (1.8s)

        at Object.<anonymous> (packages/cli/test/formatter.test.ts:78:23)
        at Promise.then.completed (node_modules/vitest/dist/chunks/runtime.js:89:5)

    ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯

expected:
  detectionConfidence: 95
  detectedTool: vitest
  failures:
    - tool: vitest
      type: test-failure
      summary: "OutputFormatter > should format validation state correctly"
      message: "Snapshot `validation state output 1` mismatched"
      location:
        file: packages/cli/test/formatter.test.ts
        line: 78
        column: 23
      context: |
        - Expected
        + Received

        - Status: ✅ PASSED
        + Status: ❌ FAILED
          Timestamp: 2025-10-22T10:30:00Z
        - Cached: true
        + Cached: false
      stackTrace:
        - file: packages/cli/test/formatter.test.ts
          line: 78
          column: 23
          function: "Object.<anonymous>"
        - file: node_modules/vitest/dist/chunks/runtime.js
          line: 89
          column: 5
          function: "Promise.then.completed"
      relevance: 100

      # What users see - terse and actionable
      llmSummary: |
        Test 'OutputFormatter > should format validation state correctly' failed in packages/cli/test/formatter.test.ts:78
        Snapshot mismatch: Status shows FAILED instead of PASSED, Cached shows false instead of true

quality:
  # Auto-generated by test runs
  lastTested: null
  fields: {}
  score: null
  issues: []
  scoreHistory: []

improvementHints:
  - "Look for 'Snapshot' keyword in error message to identify snapshot failures"
  - "Parse diff markers: '- Expected' and '+ Received' lines"
  - "Context should capture the meaningful diff lines (not all lines)"
  - "Snapshot name is in backticks after 'Snapshot' keyword"
  - "LLM summary should translate diff into human-readable changes"

relatedSamples:
  - vitest/assertion-error-001.yaml
  - vitest/test-timeout-001.yaml
