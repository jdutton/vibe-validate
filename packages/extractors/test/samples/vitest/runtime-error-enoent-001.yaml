$schema: ../sample-schema.json

# Vitest runtime error - ENOENT file system error during coverage collection

metadata:
  tool: vitest
  toolVersion: "3.2.4"
  platform: darwin
  nodeVersion: "22.0.0"
  contributor: vibe-validate
  contributedDate: "2025-10-23"
  sourceIssue: null
  sourcePR: null
  category: runtime-error
  difficulty: medium
  description: |
    Runtime error (ENOENT) that occurs during test execution, not assertion failure.
    This happens when vitest coverage tooling fails due to missing directories.
    Critical: This pattern was missed by the extractor (0% score in dogfooding).

input:
  raw: |
    RUN  v3.2.4 /Users/jeff/Workspaces/vibe-validate
         Coverage enabled with v8

    ✓ packages/core/test/result-schema-export.test.ts (2 tests) 2ms
    ✓ packages/cli/test/integration/doctor.integration.test.ts (9 tests) 14645ms
    ✓ packages/cli/test/bin.test.ts (35 tests) 6266ms
    ELIFECYCLE  Command failed with exit code 1.

    ⎯⎯⎯⎯ Unhandled Rejection ⎯⎯⎯⎯⎯

    Error: ENOENT: no such file or directory, open
    '/Users/jeff/Workspaces/vibe-validate/coverage/.tmp/coverage-2.json'
     ❯ open node:internal/fs/promises:640:25
     ❯ Object.writeFile node:internal/fs/promises:1247:14

    ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯

    Serialized Error: { errno: -2, code: 'ENOENT', syscall: 'open', path:
    '/Users/jeff/Workspaces/vibe-validate/coverage/.tmp/coverage-2.json' }

expected:
  detectionConfidence: 90
  detectedTool: vitest
  failures:
    - tool: vitest
      type: runtime-error
      summary: "Unhandled Rejection - ENOENT: no such file or directory"
      message: "Error: ENOENT: no such file or directory, open '/Users/jeff/Workspaces/vibe-validate/coverage/.tmp/coverage-2.json'"
      location:
        file: node:internal/fs/promises
        line: 640
        column: 25
      context: |
        Serialized Error: { errno: -2, code: 'ENOENT', syscall: 'open', path: '/Users/jeff/Workspaces/vibe-validate/coverage/.tmp/coverage-2.json' }
      stackTrace:
        - file: node:internal/fs/promises
          line: 640
          column: 25
          function: "open"
        - file: node:internal/fs/promises
          line: 1247
          column: 14
          function: "Object.writeFile"
      relevance: 100

      # What users see - terse and actionable
      llmSummary: |
        Runtime error during test execution: Missing directory '/Users/jeff/Workspaces/vibe-validate/coverage/.tmp/'
        ENOENT: no such file or directory

        Fix: Ensure coverage directory exists or check vitest coverage configuration

quality:
  # Auto-generated by test runs
  lastTested: null
  fields: {}
  score: null
  issues: []
  scoreHistory: []

improvementHints:
  - "Look for 'Unhandled Rejection' or 'Unhandled Error' sections"
  - "Extract ENOENT, EACCES, and other filesystem error codes"
  - "Parse 'Serialized Error' for structured error details"
  - "Provide actionable guidance (e.g., 'create missing directory')"
  - "Runtime errors are different from test assertion failures"

relatedSamples:
  - vitest/runtime-error-unhandled-promise-001.yaml
