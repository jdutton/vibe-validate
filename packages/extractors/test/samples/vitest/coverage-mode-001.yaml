$schema: ../sample-schema.json

# Vitest with --coverage flag output format

metadata:
  tool: vitest
  toolVersion: "3.2.4"
  platform: darwin
  nodeVersion: "22.0.0"
  contributor: vibe-validate
  contributedDate: "2025-10-22"
  sourceIssue: null
  sourcePR: null
  category: assertion-failure
  difficulty: medium
  description: |
    Vitest output when run with --coverage flag.
    Uses different markers: ❯ for test files and × for failures.
    Includes "Failed Tests" section with FAIL marker at the end.
    This is the output format from `vitest run --coverage`.

input:
  raw: |
     RUN  v3.2.4 /Users/jeff/Workspaces/vibe-validate
          Coverage enabled with v8

     ❯ packages/extractors/test/vitest-extractor.test.ts (15 tests | 1 failed) 6ms
       ✓ extractVitestErrors > should parse single Vitest test failure 1ms
       ✓ extractVitestErrors > should extract test hierarchy and error message 0ms
       × extractVitestErrors > DOGFOOD TEST: should demonstrate extractor extraction in CI 3ms
         → expected 42 to be 99 // Object.is equality
     ✓ packages/cli/test/bin.test.ts (35 tests) 5495ms
     ✓ packages/core/test/runner.test.ts (21 tests) 191ms

     ⎯⎯⎯⎯⎯⎯⎯ Failed Tests 1 ⎯⎯⎯⎯⎯⎯⎯

     FAIL  packages/extractors/test/vitest-extractor.test.ts > extractVitestErrors > DOGFOOD TEST: should demonstrate extractor extraction in CI
     AssertionError: expected 42 to be 99 // Object.is equality

     - Expected
     + Received

     - 99
     + 42

     ❯ packages/extractors/test/vitest-extractor.test.ts:275:16
        273|   it('DOGFOOD TEST: should demonstrate extractor extraction in CI', ()…
        274|     // This will fail with a clear assertion error
        275|     expect(42).toBe(99); // Expected: 99, Received: 42
           |                ^
        276|   });
        277| });

     ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/1]⎯

     Test Files  1 failed | 42 passed (43)
          Tests  1 failed | 652 passed (653)

expected:
  detectionConfidence: 95
  detectedTool: vitest
  failures:
    - tool: vitest
      type: test-failure
      summary: "extractVitestErrors > DOGFOOD TEST: should demonstrate extractor extraction in CI"
      message: "AssertionError: expected 42 to be 99 // Object.is equality"
      location:
        file: packages/extractors/test/vitest-extractor.test.ts
        line: 275
        column: 16
      context: |
        - Expected
        + Received

        - 99
        + 42
      stackTrace:
        - file: packages/extractors/test/vitest-extractor.test.ts
          line: 275
          column: 16
          function: ""
      relevance: 100

      # What users see - terse and actionable
      llmSummary: |
        Test 'extractVitestErrors > DOGFOOD TEST: should demonstrate extractor extraction in CI' failed in packages/extractors/test/vitest-extractor.test.ts:275
        AssertionError: expected 42 to be 99 // Object.is equality

quality:
  # Auto-generated by test runs
  lastTested: null
  fields: {}
  score: null
  issues: []
  scoreHistory: []

improvementHints:
  - "Look for '×' marker (multiplication sign) to identify failed tests in coverage mode"
  - "The '❯' marker indicates a test file in coverage mode (not a test failure)"
  - "Parse the 'FAIL' section after 'Failed Tests' divider for detailed error info"
  - "Stack trace in coverage mode shows file:line:column in '❯ file:line:column' format"
  - "Use both the inline '× test' marker AND the 'FAIL' section for complete extraction"

relatedFixtures:
  - vitest/assertion-error-001.yaml
